<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAZUR DATABASE // PROFILE V4</title>
    <style>
        :root {
            --bg-color: #050505;
            --terminal-green: #00ff41;
            --terminal-dim: #008f11;
            --alert-color: #ff3333;
        }

        body {
            background-color: var(--bg-color);
            color: var(--terminal-green);
            font-family: 'Courier New', Courier, monospace;
            margin: 0; padding: 20px;
            background-image: radial-gradient(circle, #0a0a0a 0%, #000000 100%);
        }

        /* Efeito de linhas na tela (Scanlines) */
        body::before {
            content: " "; display: block; position: fixed;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2; background-size: 100% 2px, 3px 100%; pointer-events: none;
        }

        .container { max-width: 650px; margin: 0 auto; position: relative; z-index: 3; }

        h1, h2 { text-align: center; border-bottom: 1px solid var(--terminal-dim); padding-bottom: 10px; letter-spacing: 2px; }

        input, textarea, button {
            width: 100%; box-sizing: border-box; background: #000;
            border: 1px solid var(--terminal-dim); color: var(--terminal-green);
            padding: 12px; margin-bottom: 10px; font-family: 'Courier New', monospace;
        }
        input:focus, textarea:focus { outline: none; border-color: var(--terminal-green); }

        button { font-weight: bold; cursor: pointer; text-transform: uppercase; margin-top: 10px; border: 1px solid var(--terminal-green); transition: 0.2s; }
        button:hover { background: var(--terminal-green); color: #000; }

        /* UPLOAD DE FOTO 3x4 ESTILIZADO */
        .photo-upload-container {
            display: flex; align-items: center; gap: 15px; margin-bottom: 15px; border: 1px dashed var(--terminal-dim); padding: 10px; background: rgba(0,50,0,0.1);
        }
        .photo-preview {
            width: 80px; height: 100px; /* Propor칞칚o 3x4 */
            background: #111; border: 1px solid var(--terminal-dim);
            background-size: cover; background-position: center; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #555; text-align: center;
        }

        /* CARD DE RESULTADO (LAYOUT NOVO) */
        .card {
            border: 1px solid var(--terminal-dim); padding: 15px; margin-bottom: 15px;
            background: rgba(0, 20, 0, 0.4); display: flex; gap: 15px;
            align-items: start;
        }
        .mugshot {
            width: 100px; height: 130px; /* Foto no resultado um pouco maior */
            background: #000; border: 1px solid #fff;
            object-fit: cover; flex-shrink: 0; 
        }
        .card-info { flex-grow: 1; }
        .card h3 { margin: 0 0 5px 0; color: #fff; text-transform: uppercase; font-size: 1.2em; }
        .label { font-size: 10px; color: #aaa; display: block; margin-bottom: 2px; margin-top: 8px; }
        .data-text { font-size: 14px; margin-bottom: 5px; display: block; color: #ddd; }
        
        .link-btn {
            display: inline-block; padding: 5px 10px; border: 1px solid var(--terminal-green);
            color: var(--terminal-green); text-decoration: none; font-size: 11px; margin-top: 10px;
        }
        .link-btn:hover { background: var(--terminal-green); color: #000; }
        
        /* LOGIN E ABAS */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 999; display: flex; justify-content: center; align-items: center; }
        .login-box { border: 1px solid var(--terminal-green); padding: 30px; width: 300px; background: #000; box-shadow: 0 0 20px rgba(0,255,65,0.2); }
        #app-system { display: none; }
        .hidden { display: none !important; }
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 1px solid var(--terminal-dim); }
        .tab { flex: 1; padding: 10px; text-align: center; border-right: 1px solid var(--terminal-dim); cursor: pointer; background: #0a0a0a; }
        .tab:last-child { border: none; }
        .tab.active { background: var(--terminal-green); color: #000; font-weight: bold; }

    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-box">
        <h2 style="margin-top:0">ACESSO RESTRITO</h2>
        <input type="text" id="loginUser" placeholder="USU츼RIO (mazur)">
        <input type="password" id="loginPass" placeholder="SENHA (********)">
        <button onclick="fazerLogin()">ACESSAR SISTEMA</button>
        <p id="loginError" style="color:red; display:none; text-align:center; font-size:12px; margin-top:10px;">ACESSO NEGADO</p>
    </div>
</div>

<div id="app-system" class="container">
    <div style="display:flex; justify-content:space-between; font-size:10px; color:#555; margin-bottom:10px;">
        <span>USER: <span id="displayUser">UNKNOWN</span></span>
        <span>DB STATUS: ONLINE</span>
    </div>
    
    <h1>DOSSI칅 CRIMINAL V4</h1>

    <div class="tabs">
        <div class="tab active" onclick="mudarAba('cadastro')">NOVO REGISTRO</div>
        <div class="tab" onclick="mudarAba('busca')">CONSULTAR</div>
    </div>

    <div id="cadastro">
        <p class="label" style="color:#fff; border-bottom:1px dashed #333; padding-bottom:5px;">// DADOS BIOM칄TRICOS (FOTO 3x4)</p>
        <div class="photo-upload-container">
            <div id="previewBox" class="photo-preview">SEM FOTO</div>
            <div style="flex-grow:1">
                <input type="file" id="fotoPerfil" accept="image/*" onchange="previewImagem(this)" style="border:none; padding:0;">
                <span style="font-size:10px; color:#666;">CLIQUE ACIMA PARA SELECIONAR A FOTO DO ROSTO</span>
            </div>
        </div>

        <p class="label" style="color:#fff; border-bottom:1px dashed #333; padding-bottom:5px;">// DADOS DE IDENTIFICA칂츾O</p>
        <input type="text" id="nome" placeholder="NOME COMPLETO">
        <input type="number" id="cpf" placeholder="CPF / ID (SOMENTE N칔MEROS)">
        
        <p class="label" style="color:#fff; border-bottom:1px dashed #333; padding-bottom:5px;">// ANTECEDENTES & HIST칍RICO</p>
        <textarea id="detalhes" rows="6" placeholder="DIGITE O DOSSI칅 COMPLETO..."></textarea>
        
        <p class="label" style="color:#fff; border-bottom:1px dashed #333; padding-bottom:5px;">// EVID칅NCIAS / PROVAS (ARQUIVO)</p>
        <input type="file" id="arquivoEvidencia">

        <button onclick="enviarDados()" id="btnEnviar">ARQUIVAR FICHA COMPLETA</button>
    </div>

    <div id="busca" class="hidden">
        <input type="text" id="termoBusca" placeholder="DIGITE NOME OU CPF DO ALVO...">
        <button onclick="buscarDados()" id="btnBuscar">INICIAR VARREDURA</button>
        <div id="resultados" style="margin-top:20px;"></div>
    </div>

    <p id="loading" style="text-align: center; display: none; margin-top:20px; color:yellow;">PROCESSANDO DADOS NO SERVIDOR...</p>
</div>

<script>
    // --- CONFIGURA칂츾O (SUA NOVA URL AQUI) ---
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw-N38fOeT3BG_GAVWug3FNa52zmVTRWpCPSOgdSzRTsDGsTLGNf5i6wRU-Ntrhgto4yg/exec";
    
    const VALID_USER = "mazur"; // Usu치rio do Login
    let sessionPass = ""; // Senha tempor치ria

    // 1. SISTEMA DE LOGIN
    function fazerLogin() {
        const user = document.getElementById('loginUser').value.trim();
        const pass = document.getElementById('loginPass').value.trim();
        const btn = document.querySelector('.login-box button');

        // Valida칞칚o simples de usu치rio (Case insensitive)
        if (user.toLowerCase() !== VALID_USER) return erroLogin();

        btn.innerText = "VERIFICANDO...";
        btn.disabled = true;

        // Testa a senha fazendo uma chamada leve ao Google
        fetch(`${SCRIPT_URL}?q=login_check&auth=${encodeURIComponent(pass)}`)
        .then(res => res.json())
        .then(data => {
            // Se o Google recusar a senha
            if(data[0] && data[0].erro === "ACESSO NEGADO") {
                erroLogin();
            } else {
                // Sucesso
                sessionPass = pass;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-system').style.display = 'block';
                document.getElementById('displayUser').innerText = user.toUpperCase();
            }
        }).catch(e => {
            alert("Erro de conex칚o. Verifique sua internet.");
            erroLogin();
        });

        function erroLogin() {
            document.getElementById('loginError').style.display = 'block';
            btn.innerText = "ACESSAR SISTEMA";
            btn.disabled = false;
        }
    }

    // 2. FUN칂츾O VISUAL: PREVIEW DA FOTO 3X4
    function previewImagem(input) {
        const preview = document.getElementById('previewBox');
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.style.backgroundImage = `url(${e.target.result})`;
                preview.innerText = ""; // Remove o texto "SEM FOTO"
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    // 3. NAVEGA칂츾O ENTRE ABAS
    function mudarAba(aba) {
        document.getElementById('cadastro').classList.add('hidden');
        document.getElementById('busca').classList.add('hidden');
        document.getElementById(aba).classList.remove('hidden');
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        if(aba==='cadastro') document.getElementById('resultados').innerHTML = "";
    }

    // 4. ENVIAR DADOS (UPLOAD DUPLO: FOTO + EVIDENCIA)
    async function enviarDados() {
        const nome = document.getElementById('nome').value;
        const cpf = document.getElementById('cpf').value;
        const detalhes = document.getElementById('detalhes').value;
        const fotoInput = document.getElementById('fotoPerfil');
        const evidenciaInput = document.getElementById('arquivoEvidencia');
        const btn = document.getElementById('btnEnviar');
        
        if(!nome) return alert("ERRO: NOME 칄 OBRIGAT칍RIO PARA ABRIR A FICHA.");

        btn.disabled = true; btn.innerText = "UPLOADING E CRIPTOGRAFIA...";
        document.getElementById('loading').style.display = 'block';

        // Prepara Foto de Perfil
        let fotoB64 = "", fotoMime = "", fotoNome = "";
        if (fotoInput.files.length > 0) {
            fotoB64 = await toBase64(fotoInput.files[0]);
            fotoMime = fotoInput.files[0].type;
            fotoNome = fotoInput.files[0].name;
        }

        // Prepara Evid칡ncia (Print/PDF/V칤deo)
        let evB64 = "", evMime = "", evNome = "";
        if (evidenciaInput.files.length > 0) {
            evB64 = await toBase64(evidenciaInput.files[0]);
            evMime = evidenciaInput.files[0].type;
            evNome = evidenciaInput.files[0].name;
        }

        const dados = { 
            senhaacesso: sessionPass, 
            nome, cpf, detalhes, 
            fotoBase64: fotoB64, fotoMime: fotoMime, fotoNome: fotoNome,
            arquivoBase64: evB64, arquivoMime: evMime, arquivoNome: evNome
        };

        fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(dados) })
        .then(res => res.json())
        .then(data => {
            document.getElementById('loading').style.display = 'none';
            btn.disabled = false; btn.innerText = "ARQUIVAR FICHA COMPLETA";
            
            if(data.status === "sucesso") {
                alert("SUCESSO: INDIV칈DUO FICHADO.");
                // Limpar campos
                document.getElementById('nome').value = "";
                document.getElementById('cpf').value = "";
                document.getElementById('detalhes').value = "";
                fotoInput.value = ""; evidenciaInput.value = "";
                document.getElementById('previewBox').style.backgroundImage = "none";
                document.getElementById('previewBox').innerText = "SEM FOTO";
            } else { 
                alert("ERRO NO SERVIDOR: " + data.msg); 
            }
        }).catch(e => {
            alert("FALHA CR칈TICA DE CONEX츾O.");
            btn.disabled = false;
        });
    }

    // 5. BUSCAR DADOS
    function buscarDados() {
        const termo = document.getElementById('termoBusca').value;
        const btn = document.getElementById('btnBuscar');
        
        if(!termo) return alert("DIGITE NOME OU CPF.");

        document.getElementById('loading').style.display = 'block';
        document.getElementById('resultados').innerHTML = "";
        btn.disabled = true; btn.innerText = "VARREDURA EM CURSO...";

        fetch(`${SCRIPT_URL}?q=${termo}&auth=${encodeURIComponent(sessionPass)}`)
        .then(res => res.json())
        .then(data => {
            document.getElementById('loading').style.display = 'none';
            btn.disabled = false; btn.innerText = "INICIAR VARREDURA";
            
            if(data[0] && data[0].erro) { alert("SESS츾O EXPIRADA. FA칂A LOGIN NOVAMENTE."); location.reload(); return; }
            if(data.length === 0) { document.getElementById('resultados').innerHTML = "<p align='center' style='color:#888'>// NENHUM REGISTRO ENCONTRADO.</p>"; return; }

            data.forEach(item => {
                // L칩gica: Se tem foto, mostra ela. Se n칚o, mostra caixa preta.
                let imgHtml = item.foto ? `<img src="${item.foto}" class="mugshot">` : `<div class="mugshot" style="display:flex;align-items:center;justify-content:center;color:#555;font-size:10px;">SEM FOTO</div>`;

                let html = `
                    <div class="card">
                        ${imgHtml}
                        <div class="card-info">
                            <h3>${item.nome}</h3>
                            <span class="label">IDENTIDADE (CPF):</span>
                            <span class="data-text">${item.cpf || 'N/A'}</span>
                            <span class="label">HIST칍RICO:</span>
                            <div style="font-size:13px; color:#ddd; white-space: pre-wrap; margin-bottom:10px;">${item.detalhes}</div>
                `;
                
                if(item.evidencia && item.evidencia !== "Sem anexo") {
                    html += `<a href="${item.evidencia}" target="_blank" class="link-btn">游늭 ABRIR EVID칅NCIA</a>`;
                }
                html += `</div></div>`;
                document.getElementById('resultados').innerHTML += html;
            });
        })
        .catch(e => { alert("ERRO NA BUSCA."); btn.disabled = false; });
    }

    // Utilit치rio para converter arquivo em Base64
    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = error => reject(error);
    });
</script>

</body>
</html>
